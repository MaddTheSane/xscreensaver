/*
 * Imakefile file for xscreensaver, Copyright (c) 1997 Jamie Zawinski.
 *
 * You should not need to edit this file; edit ../../config.h instead.
 *
 */

#include "../../config.h"

           STAR = *
           NULL = 
          UTILS = ../../utils
        HACKDIR = ..
       INCLUDES = -I$(UTILS) -I$(HACKDIR)
        DEFINES = R5ISMS -DSTANDALONE -DUSE_GL

#ifdef HAVE_MESAGL
         GLLIBS = -lMesaGL -lMesaGLU
#else
         GLLIBS = -lGL -lGLU
#endif

LOCAL_LIBRARIES = $(XMULIB) $(XTOOLLIB) $(GLLIBS) $(EXTENSIONLIB) $(XLIB) -lm
          HACKS = gears.c superquadrics.c escher.c pipes.c pipeobjs.c \
		  buildlwo.c sproingies.c sproingiewrap.c s1_1.o s1_2.o \
		  s1_3.c s1_4.c s1_5.c s1_6.c s1_b.c
#            MEN = gears.man superquadrics.man escher.man pipes.man \
#		  sproingies.man
       TARFILES = README Imakefile $(HACKS) $(MEN)

all::

echo_tarfiles:
	@echo $(TARFILES)

     UTIL_OBJS = $(UTILS)/colors.o $(UTILS)/grabscreen.o $(UTILS)/hsv.o \
		 $(UTILS)/resources.o $(UTILS)/spline.o $(UTILS)/usleep.o \
		 $(UTILS)/visual.o $(UTILS)/xroger.o $(UTILS)/yarandom.o

$(UTILS)/colors.o:	$(UTILS)/colors.c
$(UTILS)/grabscreen.o:	$(UTILS)/grabscreen.c
$(UTILS)/hsv.o:		$(UTILS)/hsv.c
$(UTILS)/resources.o:	$(UTILS)/resources.c
$(UTILS)/spline.o:	$(UTILS)/spline.c
$(UTILS)/usleep.o:	$(UTILS)/usleep.c
$(UTILS)/visual.o:	$(UTILS)/visual.c
$(UTILS)/xroger.o:	$(UTILS)/xroger.c
$(UTILS)/yarandom.o:	$(UTILS)/yarandom.c
$(HACKDIR)/xlockmore.o:	$(HACKDIR)/xlockmore.c

$(UTIL_OBJS):
	cd $(UTILS) ; $(MAKE)  $(@F) CC="$(CC)" CCOPTIONS="$(CCOPTIONS)"   \
		CDEBUGFLAGS="$(CDEBUGFLAGS)"

$(HACKDIR)/xlockmore.o:
	cd $(HACKDIR) ; $(MAKE)  $(@F) CC="$(CC)" CCOPTIONS="$(CCOPTIONS)"   \
		CDEBUGFLAGS="$(CDEBUGFLAGS)"

screenhack-gl.o: $(HACKDIR)/screenhack.c
	$(CC) $(CFLAGS) -DXLOCKMORE -DUSE_GL -c $< -o $@

#define	ScreenhackTarget_1(p,ps,deps,libs)				 @@\
all:: p									 @@\
p: deps $(HACKDIR)/screenhack.h ps.o $(DEPLIBS)				 @@\
	RemoveTargetProgram($@)						 @@\
	$(CCENVSETUP)							   \
	$(CC) -o $@ $(LDOPTIONS) deps ps.o libs $(LDLIBS)		 @@\
									 @@\
InstallProgram(p,$(BINDIR))						 @@\
InstallManPage(p,$(MANDIR))						 @@\
clean::									 @@\
	$(RM) p

#define ScreenhackTarget_xlock_gl(p,deps)\
p.o: $(HACKDIR)/xlockmore.h						   @@\
	ScreenhackTarget_1(p,p, $(HACKDIR)/xlockmore.o xlock-gl.o 	     \
			  $(HACK_OBJS) $(COLOR_OBJS) deps, $(LOCAL_LIBRARIES))

    HACK_OBJS = screenhack-gl.o $(UTILS)/resources.o $(UTILS)/visual.o \
		$(UTILS)/usleep.o $(UTILS)/yarandom.o
   COLOR_OBJS = $(UTILS)/hsv.o $(UTILS)/colors.o


#ifdef HAVE_GL
ScreenhackTarget_xlock_gl (gears,	  	$(NULL))
ScreenhackTarget_xlock_gl (superquadrics,	$(NULL))
ScreenhackTarget_xlock_gl (escher,	  	$(NULL))
ScreenhackTarget_xlock_gl (pipes,	  	pipeobjs.o buildlwo.o)
ScreenhackTarget_xlock_gl (sproingies,	  	sproingiewrap.o buildlwo.o \
			   s1_1.o s1_2.o s1_3.o s1_4.o s1_5.o s1_6.o s1_b.o)
SRCS=$(HACKS)
#endif /* HAVE_GL */

DependTarget()
